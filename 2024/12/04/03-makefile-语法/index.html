<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"junhu.site","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="好的，让系统地学习Makefile的规则语法。通过这个指南，你将了解Makefile规则的基本结构、各种类型的规则、常见的用法、以及在大型项目中的应用。将以具体的实例来解释每个概念。  目录 一、基础概念 Makefile规则的基本格式 目标(target)、依赖(prerequisites)和命令(commands)的含义 .PHONY目标的作用和必要性   二、规则类型及用法 基本的单目标规则">
<meta property="og:type" content="article">
<meta property="og:title" content="03-makefile 语法">
<meta property="og:url" content="http://junhu.site/2024/12/04/03-makefile-%E8%AF%AD%E6%B3%95/index.html">
<meta property="og:site_name" content="Junhu&#39;s Blog">
<meta property="og:description" content="好的，让系统地学习Makefile的规则语法。通过这个指南，你将了解Makefile规则的基本结构、各种类型的规则、常见的用法、以及在大型项目中的应用。将以具体的实例来解释每个概念。  目录 一、基础概念 Makefile规则的基本格式 目标(target)、依赖(prerequisites)和命令(commands)的含义 .PHONY目标的作用和必要性   二、规则类型及用法 基本的单目标规则">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-12-03T16:11:51.000Z">
<meta property="article:modified_time" content="2024-12-03T16:16:10.882Z">
<meta property="article:author" content="Junhu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://junhu.site/2024/12/04/03-makefile-%E8%AF%AD%E6%B3%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>03-makefile 语法 | Junhu's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Junhu's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">个人技术博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://junhu.site/2024/12/04/03-makefile-%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Junhu">
      <meta itemprop="description" content="技术分享与学习记录">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Junhu's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          03-makefile 语法
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-12-04 00:11:51 / 修改时间：00:16:10" itemprop="dateCreated datePublished" datetime="2024-12-04T00:11:51+08:00">2024-12-04</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>好的，让系统地学习Makefile的规则语法。通过这个指南，你将了解Makefile规则的基本结构、各种类型的规则、常见的用法、以及在大型项目中的应用。将以具体的实例来解释每个概念。</p>
<hr>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a><strong>目录</strong></h2><ul>
<li><strong>一、基础概念</strong><ul>
<li>Makefile规则的基本格式</li>
<li>目标(target)、依赖(prerequisites)和命令(commands)的含义</li>
<li>.PHONY目标的作用和必要性</li>
</ul>
</li>
<li><strong>二、规则类型及用法</strong><ul>
<li>基本的单目标规则</li>
<li>多目标规则的使用</li>
<li>静态模式规则的语法和应用场景</li>
<li>隐含规则的工作原理</li>
</ul>
</li>
<li><strong>三、具体示例演示</strong><ul>
<li>基本的编译规则</li>
<li>使用通配符的规则</li>
<li>多文件依赖的规则</li>
<li>常见的文件处理规则</li>
</ul>
</li>
<li><strong>四、进阶内容</strong><ul>
<li>规则的执行顺序确定方式</li>
<li>调试规则执行过程的方法</li>
<li>常见的规则编写陷阱</li>
<li>在大型项目中组织规则的方法</li>
</ul>
</li>
<li><strong>五、总结</strong></li>
</ul>
<hr>
<h2 id="一、基础概念"><a href="#一、基础概念" class="headerlink" title="一、基础概念"></a><strong>一、基础概念</strong></h2><h3 id="1-Makefile规则的基本格式"><a href="#1-Makefile规则的基本格式" class="headerlink" title="1. Makefile规则的基本格式"></a><strong>1. Makefile规则的基本格式</strong></h3><p>Makefile由一系列规则（Rules）组成，每个规则定义了如何生成一个或多个目标文件。规则的基本格式为：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">target: prerequisites</span></span><br><span class="line">    command</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li><code>target</code>和<code>prerequisites</code>之间是<strong>冒号</strong><code>:</code>，不是等号。</li>
<li><code>command</code>前面必须以<strong>TAB键</strong>（而非空格）开始。</li>
</ul>
<h3 id="2-目标-target-、依赖-prerequisites-和命令-commands"><a href="#2-目标-target-、依赖-prerequisites-和命令-commands" class="headerlink" title="2. 目标(target)、依赖(prerequisites)和命令(commands)"></a><strong>2. 目标(target)、依赖(prerequisites)和命令(commands)</strong></h3><ul>
<li><p><strong>目标（Target）：</strong></p>
<p>通常是要生成的文件（如可执行文件、对象文件等），也可以是一个操作（如<code>clean</code>）。</p>
</li>
<li><p><strong>依赖（Prerequisites）：</strong></p>
<p>生成目标所需要的文件或目标，即目标的依赖文件。如果依赖文件发生了变化，目标就需要重新生成。</p>
</li>
<li><p><strong>命令（Commands）：</strong></p>
<p>实现生成目标的具体步骤，一条或多条shell命令。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">main.o: main.c utils.h</span></span><br><span class="line">    gcc -c main.c -o main.o</span><br></pre></td></tr></table></figure>

<ul>
<li>目标：<code>main.o</code></li>
<li>依赖：<code>main.c</code>、<code>utils.h</code></li>
<li>命令：<code>gcc -c main.c -o main.o</code></li>
</ul>
<h3 id="3-PHONY目标是什么，为什么需要它？"><a href="#3-PHONY目标是什么，为什么需要它？" class="headerlink" title="3. .PHONY目标是什么，为什么需要它？"></a><strong>3. .PHONY目标是什么，为什么需要它？</strong></h3><ul>
<li><p><strong>.PHONY目标：</strong></p>
<p>声明一个目标是伪目标，即不对应实际的文件名。常用于<code>clean</code>、<code>all</code>等目标，以避免与同名文件冲突。</p>
</li>
<li><p><strong>为什么需要它：</strong></p>
<p>如果存在一个与目标同名的文件，Make会认为目标已经是最新的，不会执行命令。而声明为<code>.PHONY</code>后，Make每次都会执行对应的命令。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f *.o app</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="二、规则类型及用法"><a href="#二、规则类型及用法" class="headerlink" title="二、规则类型及用法"></a><strong>二、规则类型及用法</strong></h2><h3 id="1-如何编写基本的单目标规则"><a href="#1-如何编写基本的单目标规则" class="headerlink" title="1. 如何编写基本的单目标规则"></a><strong>1. 如何编写基本的单目标规则</strong></h3><p>单目标规则用于生成一个目标文件，语法格式如下：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">target: prerequisites</span></span><br><span class="line">    command</span><br></pre></td></tr></table></figure>

<p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">app: main.o utils.o</span></span><br><span class="line">    gcc main.o utils.o -o app</span><br></pre></td></tr></table></figure>

<ul>
<li>目标：<code>app</code></li>
<li>依赖：<code>main.o</code>、<code>utils.o</code></li>
<li>命令：编译生成可执行文件<code>app</code></li>
</ul>
<h3 id="2-多目标规则如何使用"><a href="#2-多目标规则如何使用" class="headerlink" title="2. 多目标规则如何使用"></a><strong>2. 多目标规则如何使用</strong></h3><p>多目标规则用于为多个目标指定相同的命令，语法格式如下：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">targets: prerequisites</span></span><br><span class="line">    command</span><br></pre></td></tr></table></figure>

<p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f main.o utils.o</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果有多个目标需要执行相同的命令，可以把目标写在一起：</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">main.o utils.o: shared.h</span><br><span class="line">    touch <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这意味着当<code>shared.h</code>更新时，<code>main.o</code>和<code>utils.o</code>都会执行<code>touch $@</code>命令。</li>
</ul>
<h3 id="3-静态模式规则的语法和应用场景"><a href="#3-静态模式规则的语法和应用场景" class="headerlink" title="3. 静态模式规则的语法和应用场景"></a><strong>3. 静态模式规则的语法和应用场景</strong></h3><ul>
<li><p><strong>语法格式：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">targets: target-pattern: prerequisites-patterns</span></span><br><span class="line">    command</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>作用：</strong></p>
<p>静态模式规则允许你为一组特定的目标指定规则，而不像模式规则那么通用。</p>
</li>
<li><p><strong>应用场景：</strong></p>
<p>当你有一组特定的文件需要按照特定的规则处理，但不希望这个规则应用到所有符合模式的文件时。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">objects = foo.o bar.o baz.o</span><br><span class="line"></span><br><span class="line"><span class="variable">$(objects)</span>: %.o: %.c</span><br><span class="line">    gcc -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对于<code>objects</code>中的文件，定义了从<code>.c</code>到<code>.o</code>的生成规则。</li>
</ul>
<h3 id="4-隐含规则是如何工作的"><a href="#4-隐含规则是如何工作的" class="headerlink" title="4. 隐含规则是如何工作的"></a><strong>4. 隐含规则是如何工作的</strong></h3><ul>
<li><p><strong>隐含规则：</strong></p>
<p>Makefile有一系列内置的规则，用于一些常见的构建过程，比如从<code>.c</code>编译到<code>.o</code>。</p>
</li>
<li><p><strong>工作原理：</strong></p>
<p>当Make没有在Makefile中找到目标的显式规则时，会尝试匹配隐含规则。如果找到合适的隐含规则，Make会使用它来生成目标。</p>
</li>
<li><p><strong>常见的隐含规则：</strong></p>
<ul>
<li><code>%.o: %.c</code>：将<code>.c</code>文件编译为<code>.o</code>文件。</li>
<li><code>%.c: %.y</code>：将Yacc文件编译为C源文件。</li>
</ul>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 没有显式定义 foo.o 的规则</span></span><br><span class="line"><span class="section">foo.o: foo.c</span></span><br><span class="line">    gcc -c foo.c -o foo.o</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以省略为</span></span><br><span class="line"><span class="section">foo.o:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Make会使用隐含规则来编译 foo.o</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三、具体示例演示"><a href="#三、具体示例演示" class="headerlink" title="三、具体示例演示"></a><strong>三、具体示例演示</strong></h2><h3 id="1-基本的编译规则"><a href="#1-基本的编译规则" class="headerlink" title="1. 基本的编译规则"></a><strong>1. 基本的编译规则</strong></h3><p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义源文件和目标文件</span></span><br><span class="line">SRCS = main.c utils.c</span><br><span class="line">OBJS = $(SRCS:.c=.o)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义目标</span></span><br><span class="line"><span class="section">app: <span class="variable">$(OBJS)</span></span></span><br><span class="line">    gcc <span class="variable">$(OBJS)</span> -o app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理目标</span></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f <span class="variable">$(OBJS)</span> app</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$(OBJS)</code>通过模式替换，将<code>.c</code>扩展名替换为<code>.o</code>。</li>
</ul>
<h3 id="2-使用通配符的规则"><a href="#2-使用通配符的规则" class="headerlink" title="2. 使用通配符的规则"></a><strong>2. 使用通配符的规则</strong></h3><p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取所有的源文件</span></span><br><span class="line">SRCS = <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line">OBJS = $(SRCS:.c=.o)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义目标</span></span><br><span class="line"><span class="section">app: <span class="variable">$(OBJS)</span></span></span><br><span class="line">    gcc <span class="variable">$(OBJS)</span> -o app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用隐含规则编译 .o 文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理目标</span></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f <span class="variable">$(OBJS)</span> app</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$(wildcard *.c)</code>获取当前目录下所有的<code>.c</code>文件。</li>
</ul>
<h3 id="3-多文件依赖的规则"><a href="#3-多文件依赖的规则" class="headerlink" title="3. 多文件依赖的规则"></a><strong>3. 多文件依赖的规则</strong></h3><p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义源文件和头文件</span></span><br><span class="line">SRCS = main.c utils.c</span><br><span class="line">HEADERS = utils.h common.h</span><br><span class="line">OBJS = $(SRCS:.c=.o)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义目标</span></span><br><span class="line"><span class="section">app: <span class="variable">$(OBJS)</span></span></span><br><span class="line">    gcc <span class="variable">$(OBJS)</span> -o app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义每个 .o 文件的依赖关系</span></span><br><span class="line"><span class="section">main.o: main.c <span class="variable">$(HEADERS)</span></span></span><br><span class="line"><span class="section">utils.o: utils.c utils.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理目标</span></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f <span class="variable">$(OBJS)</span> app</span><br></pre></td></tr></table></figure>

<ul>
<li>指定每个<code>.o</code>文件的依赖关系，当头文件更新时，相应的<code>.o</code>文件会重新编译。</li>
</ul>
<h3 id="4-常见的文件处理规则"><a href="#4-常见的文件处理规则" class="headerlink" title="4. 常见的文件处理规则"></a><strong>4. 常见的文件处理规则</strong></h3><p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 压缩目标</span></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: tar</span></span><br><span class="line"><span class="section">tar:</span></span><br><span class="line">    tar czvf project.tar.gz *.c *.h Makefile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装目标</span></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: install</span></span><br><span class="line"><span class="section">install:</span></span><br><span class="line">    cp app /usr/local/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载目标</span></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: uninstall</span></span><br><span class="line"><span class="section">uninstall:</span></span><br><span class="line">    rm -f /usr/local/bin/app</span><br></pre></td></tr></table></figure>

<ul>
<li>定义一些常用的操作，例如打包、安装、卸载。</li>
</ul>
<hr>
<h2 id="四、进阶内容"><a href="#四、进阶内容" class="headerlink" title="四、进阶内容"></a><strong>四、进阶内容</strong></h2><h3 id="1-规则的执行顺序是如何确定的"><a href="#1-规则的执行顺序是如何确定的" class="headerlink" title="1. 规则的执行顺序是如何确定的"></a><strong>1. 规则的执行顺序是如何确定的</strong></h3><ul>
<li><p><strong>默认目标：</strong></p>
<p>Makefile中第一个出现的目标（非声明伪目标）是默认目标，<code>make</code>命令在不指定目标时会构建它。</p>
</li>
<li><p><strong>依赖关系决定执行顺序：</strong></p>
<p>Make根据依赖关系构建目标树，从叶子节点开始，先构建依赖的目标，再构建依赖它的目标。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">app: main.o utils.o</span></span><br><span class="line">    gcc main.o utils.o -o app</span><br><span class="line"></span><br><span class="line"><span class="section">main.o: main.c utils.h</span></span><br><span class="line">    gcc -c main.c -o main.o</span><br><span class="line"></span><br><span class="line"><span class="section">utils.o: utils.c utils.h</span></span><br><span class="line">    gcc -c utils.c -o utils.o</span><br></pre></td></tr></table></figure>

<ul>
<li>构建<code>app</code>时，会先构建<code>main.o</code>和<code>utils.o</code>。</li>
</ul>
<h3 id="2-如何调试规则执行过程"><a href="#2-如何调试规则执行过程" class="headerlink" title="2. 如何调试规则执行过程"></a><strong>2. 如何调试规则执行过程</strong></h3><ul>
<li><p><strong>使用<code>make -n</code>或<code>make --just-print</code>：</strong></p>
<p>显示将要执行的命令，但不实际执行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -n</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用<code>make -d</code>或<code>make --debug</code>：</strong></p>
<p>显示Make的调试信息，包括规则匹配、依赖分析等。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -d</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用<code>make -p</code>或<code>make --print-data-base</code>：</strong></p>
<p>显示所有的变量和隐含规则。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -p</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-常见的规则编写陷阱"><a href="#3-常见的规则编写陷阱" class="headerlink" title="3. 常见的规则编写陷阱"></a><strong>3. 常见的规则编写陷阱</strong></h3><ul>
<li><p><strong>命令前的TAB键：</strong></p>
<p>命令行必须以<strong>TAB键</strong>开头，使用空格会导致语法错误。</p>
</li>
<li><p><strong>规则间的空行：</strong></p>
<p>两个规则之间至少要有一个空行，否则Make可能无法正确解析规则。</p>
</li>
<li><p><strong>变量展开时的细节：</strong></p>
<p>当使用变量时，注意变量的展开方式，是否需要加<code>$()</code>。</p>
</li>
</ul>
<p><strong>示例错误：</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OBJS = main.o utils.o</span><br><span class="line"></span><br><span class="line"><span class="section">app: <span class="variable">$(OBJS)</span></span></span><br><span class="line">gcc <span class="variable">$(OBJS)</span> -o app   <span class="comment"># 缺少TAB键</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确写法</span></span><br><span class="line"><span class="section">app: <span class="variable">$(OBJS)</span></span></span><br><span class="line">    gcc <span class="variable">$(OBJS)</span> -o app</span><br></pre></td></tr></table></figure>

<h3 id="4-在大型项目中如何组织规则"><a href="#4-在大型项目中如何组织规则" class="headerlink" title="4. 在大型项目中如何组织规则"></a><strong>4. 在大型项目中如何组织规则</strong></h3><ul>
<li><p><strong>按模块划分Makefile：</strong></p>
<p>将每个模块的编译规则放在独立的Makefile中，主Makefile包含子Makefile。</p>
</li>
<li><p><strong>使用递归Make：</strong></p>
<p>在主Makefile中，使用<code>$(MAKE)</code>调用子目录下的Makefile。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<p>主目录的Makefile：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SUBDIRS = module1 module2</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: all clean $(SUBDIRS)</span></span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(SUBDIRS)</span></span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(SUBDIRS)</span>:</span><br><span class="line">    <span class="variable">$(MAKE)</span> -C <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    for dir in <span class="variable">$(SUBDIRS)</span>; do \</span><br><span class="line">        <span class="variable">$(MAKE)</span> -C $$dir clean; \</span><br><span class="line">    done</span><br></pre></td></tr></table></figure>

<p>子目录<code>module1/Makefile</code>：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义模块1的编译规则</span></span><br><span class="line"><span class="section">module1.o: module1.c</span></span><br><span class="line">    gcc -c module1.c -o module1.o</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f module1.o</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a><strong>五、总结</strong></h2><p>通过以上的讲解，系统地学习了Makefile的规则语法，包括基本的规则格式、目标、依赖和命令的含义，以及<code>.PHONY</code>目标的作用。了解了如何编写基本的单目标规则和多目标规则，静态模式规则的使用方法，以及隐含规则的工作原理。</p>
<p>在具体的示例中，演示了如何编写基本的编译规则，如何使用通配符和模式替换，如何处理多文件的依赖关系，以及常见的文件处理规则。</p>
<p>在进阶内容中，讨论了Makefile如何确定规则的执行顺序，如何调试规则的执行过程，常见的规则编写陷阱，以及在大型项目中如何组织规则。</p>
<p>希望通过这些内容，你能够深入理解Makefile规则的语法和用法，在实际项目中灵活运用，提高构建自动化的效率和可靠性。</p>
<hr>
<p><strong>附加说明：</strong></p>
<ul>
<li><p><strong>学习Makefile的进一步建议：</strong></p>
<ul>
<li>阅读官方文档或权威书籍，例如GNU Make手册。</li>
<li>在实际项目中多实践，探索高级特性，如函数、条件语句等。</li>
<li>参考开源项目的Makefile，学习他们的组织方式和技巧。</li>
</ul>
</li>
<li><p><strong>常用的Makefile技巧：</strong></p>
<ul>
<li>使用变量和模式，简化规则的书写。</li>
<li>利用Make的自动化特性，避免手动指定所有依赖关系。</li>
<li>充分利用Make的隐含规则和内置功能，减少冗余。</li>
</ul>
</li>
</ul>
<hr>
<p>希望这些内容对你有所帮助，祝你在Makefile的学习和实践中取得成功！</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/12/03/02-Makefile%E5%AE%9E%E4%BE%8B-%E5%A4%9A%E5%AD%90%E6%96%87%E4%BB%B6%E5%92%8C%E5%BA%93%E9%93%BE%E6%8E%A5/" rel="prev" title="02-Makefile实例 多子文件和库链接">
      <i class="fa fa-chevron-left"></i> 02-Makefile实例 多子文件和库链接
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/12/23/ARM-NONE-EABI-%E5%B7%A5%E5%85%B7%E9%93%BE%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" rel="next" title="ARM-NONE-EABI 工具链完整使用指南">
      ARM-NONE-EABI 工具链完整使用指南 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-number">2.</span> <span class="nav-text">一、基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Makefile%E8%A7%84%E5%88%99%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A0%BC%E5%BC%8F"><span class="nav-number">2.1.</span> <span class="nav-text">1. Makefile规则的基本格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%9B%AE%E6%A0%87-target-%E3%80%81%E4%BE%9D%E8%B5%96-prerequisites-%E5%92%8C%E5%91%BD%E4%BB%A4-commands"><span class="nav-number">2.2.</span> <span class="nav-text">2. 目标(target)、依赖(prerequisites)和命令(commands)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-PHONY%E7%9B%AE%E6%A0%87%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%83%EF%BC%9F"><span class="nav-number">2.3.</span> <span class="nav-text">3. .PHONY目标是什么，为什么需要它？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E8%A7%84%E5%88%99%E7%B1%BB%E5%9E%8B%E5%8F%8A%E7%94%A8%E6%B3%95"><span class="nav-number">3.</span> <span class="nav-text">二、规则类型及用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%8D%95%E7%9B%AE%E6%A0%87%E8%A7%84%E5%88%99"><span class="nav-number">3.1.</span> <span class="nav-text">1. 如何编写基本的单目标规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%A4%9A%E7%9B%AE%E6%A0%87%E8%A7%84%E5%88%99%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="nav-number">3.2.</span> <span class="nav-text">2. 多目标规则如何使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%9D%99%E6%80%81%E6%A8%A1%E5%BC%8F%E8%A7%84%E5%88%99%E7%9A%84%E8%AF%AD%E6%B3%95%E5%92%8C%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">3.3.</span> <span class="nav-text">3. 静态模式规则的语法和应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E9%9A%90%E5%90%AB%E8%A7%84%E5%88%99%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="nav-number">3.4.</span> <span class="nav-text">4. 隐含规则是如何工作的</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%85%B7%E4%BD%93%E7%A4%BA%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="nav-number">4.</span> <span class="nav-text">三、具体示例演示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99"><span class="nav-number">4.1.</span> <span class="nav-text">1. 基本的编译规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8%E9%80%9A%E9%85%8D%E7%AC%A6%E7%9A%84%E8%A7%84%E5%88%99"><span class="nav-number">4.2.</span> <span class="nav-text">2. 使用通配符的规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%A4%9A%E6%96%87%E4%BB%B6%E4%BE%9D%E8%B5%96%E7%9A%84%E8%A7%84%E5%88%99"><span class="nav-number">4.3.</span> <span class="nav-text">3. 多文件依赖的规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%B8%B8%E8%A7%81%E7%9A%84%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E8%A7%84%E5%88%99"><span class="nav-number">4.4.</span> <span class="nav-text">4. 常见的文件处理规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E8%BF%9B%E9%98%B6%E5%86%85%E5%AE%B9"><span class="nav-number">5.</span> <span class="nav-text">四、进阶内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%A7%84%E5%88%99%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E7%A1%AE%E5%AE%9A%E7%9A%84"><span class="nav-number">5.1.</span> <span class="nav-text">1. 规则的执行顺序是如何确定的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E8%A7%84%E5%88%99%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="nav-number">5.2.</span> <span class="nav-text">2. 如何调试规则执行过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%B8%B8%E8%A7%81%E7%9A%84%E8%A7%84%E5%88%99%E7%BC%96%E5%86%99%E9%99%B7%E9%98%B1"><span class="nav-number">5.3.</span> <span class="nav-text">3. 常见的规则编写陷阱</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%9C%A8%E5%A4%A7%E5%9E%8B%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%A6%82%E4%BD%95%E7%BB%84%E7%BB%87%E8%A7%84%E5%88%99"><span class="nav-number">5.4.</span> <span class="nav-text">4. 在大型项目中如何组织规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%80%BB%E7%BB%93"><span class="nav-number">6.</span> <span class="nav-text">五、总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Junhu</p>
  <div class="site-description" itemprop="description">技术分享与学习记录</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yourusername" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourusername" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:your@email.com" title="E-Mail → mailto:your@email.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2024 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Junhu</span>

  <!-- 添加访客统计 -->
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">
    总访问量: <span id="busuanzi_value_site_pv"></span> 次
  </span>
  <span id="busuanzi_container_site_uv">
    | 访客数: <span id="busuanzi_value_site_uv"></span> 人
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
